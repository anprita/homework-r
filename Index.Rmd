---
title: "R Homework"
author: "Heva, Prita, Supria"
date: "March 29, 2018"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Data Visualization in R : Long-term monitoring of a rodent community

Our homework is analyzing database of a long term monitoring for rodent community in Chihuahuan Desert ecosystem near Portal, Arizona, from 1977 to 2000. At this site, 24 experimental plots were established in 1977 and divided among controls and experimental manipulations. The long-term data for the rodent community at the Portal Project has been used to address a variety of questions including 
<ul>
  <li>Monitoring the population-level dynamics of desert rodents & competitive interactions among rodent species.</li>
  <li>Responses of rodents to climatic variability.</li>
  <li>The long-term stability and dynamics of a desert rodent community.</li>
</ul>  

This is our R-homework documentation. The process of data visualisation using R can be divided into four steps : 
<ul>
  <li>Load the library</li>
  <li>Read the data file</li>
  <li>Clean the data</li>
  <li>Time series data of sex and number of sample per plot type</li>
  <li>Correlation between length of hindfoot and weight of animal</li>
  <li>Changes of weight over the year based on each plot type</li>
  <li>Changes of length of hindfoot  over the year based on each plot type</li>
  <li>Correlation between hindfoot length and genus</li>
  <li>Correlation between hindfoot length and genus</li>
</ul>

<strong>Load the library</strong>

```{r load, warning=FALSE, message=FALSE}
library(tidyverse)
library(lubridate)
library(gridExtra)
library(ggplot2)
library(dbplyr)
library(ggpubr)
```

<strong>Read the data file</strong>

Our team decide to read the combined.csv file because it has the most comprehensive, consise, and compact data. 

```{r read}
surveys_combined <- read.csv("data/combined.csv")
```
Below is the information about the data structure:

<div id="str">
  <img src="image/str.png" alt="">
</div> 

<strong>Clean the data</strong>

Our team read the raw data and transform it into consistent data that can be analyzed. It is aimed at improving the content of statistical statements based on the data as well as their reliability. This proces is Data Cleaning. In this homework, we ignore the missing data ('', NULL, is.Na).

```{r clear1}
surveys_combined_clear<- surveys_combined %>% filter(!is.na(sex), 
                                                         sex != "",
                                                         !is.na(hindfoot_length), 
                                                         hindfoot_length != "",
                                                         !is.na(weight), 
                                                         weight != "") 
```

The result of data cleaning : 

<table border="1">
<tr><th colspan="2">&nbsp; Data Cleaning &nbsp;</th></tr>
<tr><th>&nbsp; Before &nbsp;</th><th>&nbsp; After &nbsp;</th></tr>
<tr><td>&nbsp; 34,786 &nbsp;</td><td>&nbsp; 30,676 &nbsp;</td></tr>
</table>
<br/>

For the simple distribution tables below the 1st and 3rd Qu. refer to the first and third quartiles, indicating that 25% 
of the observations have values of that variable which are less than or greater than (respectively) the value listed.

<div id="str">
  <img src="image/stat.png" alt="">
</div> 

<strong>Time series data of sex and number of sample per plot type</strong>
  
```{r plot1, warning=FALSE, message=FALSE}
#create line chart plot type per year
year_plot_type <- surveys_combined_clear %>% group_by(year, plot_type) %>% tally()
line_chart <- ggplot(year_plot_type, aes(x=year, y=n, color=plot_type)) + 
  geom_line() + xlab("Year") + ylab("Plot Type")

#create bar chart sex per year
year_sex <- surveys_combined_clear %>% group_by(year, sex) %>% tally()
bar_chart <- ggplot(year_sex, aes(x=year, y=n, color=sex)) + 
  geom_bar(stat="identity") + xlab("Year") + ylab("Sex")

#put chart to grid
timeseries_plot <- grid.arrange(line_chart, bar_chart, ncol=2, widths=c(9,6))

#save plot into image
ggsave("image/plot1.jpg", timeseries_plot, width=15, dpi=300)
```

The line graph illustrates the number of rodent sample among controls and other experimental manipulations. Each sample indicates data for every desert rodent caught on the 20 ha. And the bar graph shows the number of rodent differentiate by sex. Overall, there is a trend of decreasing number of sample but it increase in 2000. 

```{r plot2, warning=FALSE, message=FALSE}
#create boxplot chart weight per plot_type
boxplot_chart_weight <- ggplot(surveys_combined_clear, aes(x=weight, y=plot_type))+
  geom_boxplot()+xlab("Weight (gr)")+ylab("Plot Type") +  geom_jitter()

#create boxplot chart hindfoot length per plot_type
boxplot_chart_length <- ggplot(surveys_combined_clear, aes(x=hindfoot_length, y=plot_type))+
  geom_boxplot()+xlab("Hindfoot Length (mm)")+ylab("Plot Type") + geom_jitter()

#put chart to grid
frequency_plot <- grid.arrange(boxplot_chart_length, boxplot_chart_weight, ncol=2, widths=c(8,7))

#save plot into image
ggsave("image/plot2.jpg", frequency_plot, width=15, dpi=300)
```

This boxplot graph explain the distribution of hindfoot length and weight per plot type. Detail correlation will be explain below. 

<strong>Correlation between length of hindfoot and weight of animal</strong>

```{r plot3, warning=FALSE, message=FALSE}
# Created by supria
# Scatter plot with correlation coefficient
#:::::::::::::::::::::::::::::::::::::::::::::::::
sp <- ggscatter(surveys_combined_clear, x = "hindfoot_length", y = "weight",title = "Relationship between weight and length of hindfoot", xlab = "length of hindfoot (mm)", ylab = "Weightof animal(gm)",
                add = "reg.line",  # Add regressin line
                add.params = list(color = "blue", fill = "lightgray"), # Customize reg. line
                conf.int = TRUE # Add confidence interval
)
# Add correlation coefficient
final.plot<- sp + stat_cor(method = "pearson", label.x = 10, label.y = 200)
final.plot
#save plot into image
ggsave("image/plot3.jpg", final.plot, width=10, dpi=300)
```
This plot means that what is the relationship between weight of animal and length of hindfoot length. Using statistic analysis we found that thera is linear correlation. And the value of R-squared is greater than .5. It has shown there is 68% linearly correlated. 

<strong>Changes of weight over the year based on each plot type</strong>
```{r plot4, warning=FALSE, message=FALSE}
# created by supria
wg<- ggscatter(data=surveys_combined_clear, x='year',y='weight', color ="plot_type",shape = "plot_type",
               title = "Weight changes over the year based on each plot type", xlab = "Year", ylab = "Weight of animal(gm)",
          add = "reg.line",  # Add regressin line
          add.params = list(color = "blue","red","green","yellow","pink", fill = "lightgray"), # Customize reg. line
          conf.int = TRUE # Add confidence interval
 )  
# Add correlation coefficient
final.wg <- wg + stat_cor(method = "pearson", label.x = 1995, label.y = 200)
final.wg
ggsave("image/plot4.jpg", final.wg, width=10, dpi=300)
```
This plot explains about what is the change of weight over the year for each plot_type. It has shown that there is no relationship of weight over the year.
R-squared value explains that -.27 which is very low.

<strong>Changes of length of hindfoot  over the year based on each plot type</strong>
```{r plot5, warning=FALSE, message=FALSE}
# Created by supria
# Extend the regression lines beyond the domain of the data
##hindfoot changes over the year

hd<- ggscatter(data=surveys_combined_clear, x='year',y='hindfoot_length', color ="plot_type",shape = "plot_type",
               title = "Hindfoot length changes over the year based on each plot type", xlab = "Year", ylab = "length of Hindfoot(mm)",
               add = "reg.line",  # Add regressin line
               add.params = list(color = "blue","red","green","yellow","pink", fill = "lightgray"), # Customize reg. line
               conf.int = TRUE # Add confidence interval
)  
# Add correlation coefficient
final.hd<- hd + stat_cor(method = "pearson", label.x = 1995, label.y = 200)
final.hd
ggsave("image/plot5.jpg", final.wg, width=10, dpi=300)
```
This plot explains about what is the change of length of hindfoot over the year for each plot_type. It has shown that there is no relationship of weight over the year.
R-squared value explains that -.28 which is very low.

<strong>Heva : Correlation between hindfoot length and genus</strong>
```{r plot6}
#heva

```


<strong>Heva : Correlation between hindfoot length and genus</strong>
```{r plot7}
#heva

```

